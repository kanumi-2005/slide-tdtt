%!TeX program = lualatex
%!TeX root = main.tex

\section{Cây Đỏ-Đen}

\subsection{Giới thiệu}

\begin{frame}
	\frametitle{\insertsection}
	\framesubtitle{Định nghĩa}
	\begin{block}{Thành phần của nút}
		Nút trong cây đỏ-đen gồm các thuộc tính là \begin{description}
			\item[color] Màu của nút đó.
			\item[key] Giá trị được lưu.
			\item[left] Nút con bên trái.
			\item[right] Nút con bên phải.
			\item[parent] Nút cha.
		\end{description}
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{\insertsection}
	\framesubtitle{Định nghĩa}
	\begin{block}{Định nghĩa cây đỏ-đen}
		Cây đỏ-đen là một cây nhị phân tìm kiếm thỏa mãn các tính chất sau: \begin{enumerate}
			\item Mỗi nút trong cây phải có màu đen hoặc đỏ.
			\item Nút gốc phải có màu đen.
			\item Nút lá phải có màu đen.
			\item Một nút có màu đỏ thì tất cả nút con nó phải màu đen.
			\item Mọi đường đi từ một nút bất kì trong cây đến các nút hậu duệ lá đều phải có số lượng nút đen bằng nhau.
		\end{enumerate}
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{\insertsection}
	\framesubtitle{Định nghĩa}
	\begin{block}{Nhận xét}
		\begin{itemize}
			\item Mọi đường đi từ nút gốc đến nút lá có số nút chênh nhau không quá 2 lần.
			\item Mọi cây con của cây đỏ-đen cũng là cây đỏ-đen\only<2->{ \alert<2>{nếu đổi màu nút gốc thành đen}}.
			\item Tính chất cuối có thể thay \alert{nút bất kì} thành \alert{nút gốc}.
		\end{itemize}
	\end{block}
\end{frame}

\forestset{
  node/.style={font={\scriptsize},circle,draw=black,minimum size=1.2em,inner sep=1pt,fill=none,text=black},
  black-node/.style={fill=black,text=white},
  nil-node/.style={rectangle,content={}, minimum size=5pt},
  red-node/.style={draw=red!70!black,fill=red!80!black},
  none-node/.style={node,draw=none,fill=none,shape=rectangle},
  tree/.style={for tree={node}},
  rb-tree/.style={tree,for tree={black-node}},
}

\begin{frame}
	\frametitle{\insertsection}
	\framesubtitle{Ví dụ}
		\centering
		\begin{forest}
			for tree={s sep= 3mm},
			rb-tree
			[26
				[17,red-node
					[14
						[10,red-node
							[7
								[3,red-node
									[,nil-node]
									[,nil-node]
								]
								[,nil-node]
							]
							[12
								[,nil-node]
								[,nil-node]
							]
						]
						[16
							[15,red-node
								[,nil-node]
								[,nil-node]
							]
							[,nil-node]
						]
					]
					[21
						[19
							[,nil-node]
							[20,red-node
								[,nil-node]
								[,nil-node]
							]
						]
						[23
							[,nil-node]
							[,nil-node]
						]
					]
				]
				[41
					[30,red-node
						[28
							[,nil-node]
							[,nil-node]
						]
						[38
							[35,red-node
								[,nil-node]
								[,nil-node]
							]
							[39,red-node
								[,nil-node]
								[,nil-node]
							]
						]
					]
					[47
						[,nil-node]
						[,nil-node]
					]
				]
			]
		\end{forest}
\end{frame}

\subsection{Các thao tác trên cây}
\begin{frame}
\frametitle{\insertsection}
\framesubtitle{Phép quay}
\begin{block}{Minh họa}
	\centering
	\begin{tikzpicture}[>=Stealth]
		\node (lefttree) {
			\begin{forest}
				tree,
				for tree={fit=tight,font={\scriptsize},s sep=2em,l=5mm}
				[,none-node
					[y
						[x
							[$\alpha$]
							[$\beta$,none-node]
						]
						[$\gamma$,none-node]
					]
				]
			\end{forest}
		};
		% Cây bên phải (xoay phải)
		\node[right=2cm of lefttree] (righttree) {
			\begin{forest}
				tree,
				for tree={fit=tight,font=\scriptsize,s sep=2em,l=5mm}
				[,none-node
					[x
						[$\gamma$,none-node]
						[y
							[$\beta$,none-node]
							[$\gamma$,none-node]
						]
					]
				]
			\end{forest}
		};
	
		% Vẽ mũi tên 2 đầu ở giữa
\draw[->, thick, cyan] 
    ($(righttree.west)+(0,0.1cm)$)  -- ($(lefttree.east)+(0,0.1cm)$)
    node[midway, above]{Trái};

% Mũi tên "phải" (hạ xuống dưới)
\draw[->, thick, cyan] 
    ($(lefttree.east)+(0,-0.1cm)$) -- ($(righttree.west)+(0,-0.1cm)$) 
    node[midway, below]{Phải};
	\end{tikzpicture}
\end{block}
\end{frame}


\begin{frame}
	\frametitle{\insertsection}
	\framesubtitle{Phép chèn}
	\begin{block}{Trường hợp 1}
		\centering
		\begin{tikzpicture}[>=Stealth]
			\node (lefttree) {
				\begin{forest}
					rb-tree,
					for tree={fit=band,l=0pt,s sep=1em}
					[C
						[A,red-node
							[$\alpha$,none-node]
							[B,red-node,label=right:z
								[$\beta$,none-node]
								[$\gamma$,none-node]
							]
						]
						[D,red-node,label=right:y
							[$\delta$,none-node]
							[$\epsilon$,none-node]
						]
					]
				\end{forest}
			};
			% Cây bên phải (xoay phải)
			\node[right=2cm of lefttree] (righttree) {
				\begin{forest}
					rb-tree,
					for tree={fit=band,l=0pt,s sep=1em}
					[C,red-node,label=right:{new z}
						[A
							[$\alpha$,none-node]
							[B,red-node
								[$\beta$,none-node]
								[$\gamma$,none-node]
							]
						]
						[D
							[$\delta$,none-node]
							[$\epsilon$,none-node]
						]
					]
				\end{forest}
			};
			\draw[->, thick, cyan] 
			    (lefttree.east) -- (righttree.west);
		\end{tikzpicture}
		\\
		\begin{tikzpicture}[>=Stealth]
			\node (lefttree) {
				\begin{forest}
					rb-tree,
					for tree={fit=band,l=0pt,s sep=1em}
					[C
						[A,red-node
							[B,red-node,label=right:z
								[$\alpha$,none-node]
								[$\beta$,none-node]
							]
							[$\gamma$,none-node]
						]
						[D,red-node,label=right:y
							[$\delta$,none-node]
							[$\epsilon$,none-node]
						]
					]
				\end{forest}
			};
			% Cây bên phải (xoay phải)
			\node[right=2cm of lefttree] (righttree) {
				\begin{forest}
					rb-tree,
					for tree={fit=band,l=0pt,s sep=1em}
					[C,red-node,label=right:{new z}
						[A
							[B,red-node
								[$\alpha$,none-node]
								[$\beta$,none-node]
							]
							[$\gamma$,none-node]
						]
						[D
							[$\delta$,none-node]
							[$\epsilon$,none-node]
						]
					]
				\end{forest}
			};
			\draw[->, thick, cyan] 
			    (lefttree.east) -- (righttree.west);
		\end{tikzpicture}
	\end{block}
\end{frame}