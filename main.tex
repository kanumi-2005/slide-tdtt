%!TeX program = lualatex
\documentclass{beamer}
\usepackage{forest} % Vẽ cây
\usepackage{polyglossia} 
\setdefaultlanguage{vietnamese}
\setotherlanguage{english}
\usepackage{import}
\usepackage[ruled,vlined]{algorithm2e}
\usepackage{tabularray}

\usetikzlibrary{arrows.meta,matrix,positioning}
\usepackage{minted}

\usepackage[skip=6pt]{caption}  % trong preamble
\captionsetup[table]{position=above}

\tikzset{
  invisible/.style={opacity=0, text opacity=0},
  visible on/.style={alt={#1{}{invisible}}},
  alt/.code args={<#1>#2#3}{%
    \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % Nếu đúng slide: hiện (#2), sai: ẩn (#3)
  }
}
% ----------------------------------------------------------------

\ExplSyntaxOn

\bool_new:N \l_phu_pause_bool

\keys_define:nn { phu / twotrees }
 {
   pause .bool_set:N = \l_phu_pause_bool,
   pause .default:n = true,
 }

\NewDocumentEnvironment{twotrees}{ O{} m m m m }
 {
   \bool_set_false:N \l_phu_pause_bool
   \keys_set:nn { phu / twotrees } { #1 }

   % --- GIẢI PHÁP AN TOÀN TUYỆT ĐỐI ---
   % Thay vì chèn biến vào lệnh \node, ta định nghĩa style cho TikZ ngay tại đây.
   \bool_if:NTF \l_phu_pause_bool
     {
        % Nếu Pause: Node hiện lần lượt <+->, Mũi tên hiện cùng lúc <.->
        \tikzset{ phu_node_style/.style = { visible~on=<+-> } }
        \tikzset{ phu_arrow_style/.style = { visible~on=<.-> } }
     }
     {
        % Nếu Không Pause: Không làm gì cả (hiện luôn)
        \tikzset{ phu_node_style/.style = {} }
        \tikzset{ phu_arrow_style/.style = {} }
     }

   \seq_set_split:Nnn \l_tmpa_seq {/} {#5}
   \seq_pop_left:NN \l_tmpa_seq \l_phu_note_left_tl
   \seq_pop_left:NN \l_tmpa_seq \l_phu_note_right_tl

   \begin{tikzpicture}[>=stealth]

    % --- CÂY TRÁI ---
    % Dùng style "phu_node_style" đã định nghĩa ở trên. Không cần \exp_args rắc rối.
    \node [phu_node_style, anchor=north\space west] (lefttree) at (0, 0) {#2};
    
    % --- CÂY PHẢI ---
    % Vì dùng "visible on", lefttree vẫn nằm đó (tàng hình) nên righttree neo vào được -> HẾT LỖI.
    \node [phu_node_style, right=#4\space of\space lefttree.north\space east, anchor=north\space west] (righttree) {#3};

     % --- MŨI TÊN ---
     \tl_if_blank:VTF \l_phu_note_right_tl
       {
         \draw [phu_arrow_style, ->, thick, cyan, text=black]
           (lefttree.east) -- node[below]{\l_phu_note_left_tl} ($(lefttree.east)+(#4,0)$);
       }
       {
         \draw [phu_arrow_style, ->, thick, cyan, text=black]
           ($(lefttree.east)+(0,0.1cm)$) -- node[above,text=black]{\l_phu_note_left_tl} ($(lefttree.east)+(#4,0.1cm)$);

         \draw [phu_arrow_style, <-, thick, yshift=6pt, cyan, text=black]
           ($(lefttree.east)-(0,0.1cm)$) -- node[below]{\l_phu_note_right_tl} ($(lefttree.east)+(#4,-0.1cm)$);
       }
 }
 {
   \end{tikzpicture}
 }

\ExplSyntaxOff

\ExplSyntaxOn

% --- 2. Khai báo biến ---
\tl_new:N \l_label_one_tl
\tl_new:N \l_label_two_tl

% --- 3. Định nghĩa option ---
\keys_define:nn { phu / threetrees }
 {
   pause .bool_set:N = \l_phu_pause_bool,
   pause .default:n = true,
 }

\NewDocumentEnvironment{threetrees}{ O{} mmmmm }
 {
   % #1: Option [pause]
   % #2: Node 1 (Trái)
   % #3: Node 2 (Giữa)
   % #4: Node 3 (Phải)
   % #5: Khoảng cách
   % #6: Label "Text 1 / Text 2"

   \bool_set_false:N \l_phu_pause_bool
   \keys_set:nn { phu / threetrees } { #1 }

   % Logic Style: Nếu pause -> style node=<+->, style arrow=<.-> (hiện cùng node)
   \bool_if:NTF \l_phu_pause_bool
     {
        \tikzset{ phu_node_style/.style = { visible~on=<+-> } }
        \tikzset{ phu_arrow_style/.style = { visible~on=<.-> } }
     }
     {
        \tikzset{ phu_node_style/.style = {} }
        \tikzset{ phu_arrow_style/.style = {} }
     }

   % Tách label
   \seq_set_split:Nnn \l_tmpa_seq {/} {#6}
   \seq_pop_left:NN \l_tmpa_seq \l_label_one_tl
   \seq_if_empty:NTF \l_tmpa_seq
     { \tl_clear:N \l_label_two_tl }
     { \seq_pop_left:NN \l_tmpa_seq \l_label_two_tl }

   \begin{tikzpicture}[>=Stealth]

   % --- BƯỚC 1: VẼ CÂY 1 ---
   % Slide i: Hiện Cây 1
   \node[phu_node_style, anchor=north~west] (treeOne) at (0, 0) {#2};
   
   % --- BƯỚC 2: VẼ CÂY 2 & MŨI TÊN 1 ---
   % Slide i+1: Hiện Cây 2 (nhờ style <+->) và Mũi tên 1 (nhờ style <.->)
   \node[phu_node_style, right=#5~of~treeOne.north~east, anchor=north~west] (treeTwo) {#3};
   
   \draw[phu_arrow_style, ->, thick, cyan, text=black]
     (treeOne.east) -- node[above=2pt] {\l_label_one_tl} ($(treeOne.east)+(#5,0)$);

   % --- BƯỚC 3: VẼ CÂY 3 & MŨI TÊN 2 ---
   % Slide i+2: Hiện Cây 3 và Mũi tên 2
   \node[phu_node_style, right=#5~of~treeTwo.north~east, anchor=north~west] (treeThree) {#4};

   \draw[phu_arrow_style, ->, thick, cyan, text=black]
     (treeTwo.east) -- node[above=2pt] {\l_label_two_tl} ($(treeTwo.east)+(#5,0)$);

 }
 {
   \end{tikzpicture}
 }

\ExplSyntaxOff

\forestset{
  node/.style={font={\scriptsize},circle,draw=black,minimum size=1.2em,inner sep=1pt,fill=none,text=black},
  black-node/.style={fill=black,text=white},
  nil-node/.style={rectangle,content={}, minimum size=5pt},
  red-node/.style={node,text=white,draw=red!70!black,fill=red!80!black},
  non-decorate-node/.style={node,draw=none,fill=none,shape=rectangle,text=black},
  tree/.style={for tree={node}},
  rb-tree/.style={tree,for tree={black-node}},
  empty-node/.style={non-decorate-node, minimum size=0pt, inner sep=1pt,content={}},
  rand-node/.style={node,text=white,fill=brown!90!black,draw=brown!70!black},
}


% Title setup
\title{Cây nhị phân tìm kiếm cân bằng}
\subtitle{Cây AVL và Cây Đỏ-đen}
\author{Huỳnh Thiên An -- 23120001\and Hoàng Ngọc Phú -- 23120010\and Hoàng Ngọc Quí -- 23120077\and Nguyễn Duy Bảo -- 23120113}
\institute{Giảng viên: Thầy Nguyễn Hải Đăng}
\date{Thứ ba, ngày 2 tháng 12 năm 2025}

% Beamer setup
% Gói cần thiết
\usetheme{default} % theme cơ bản, bạn có thể đổi theme khác nếu muốn

% ---------------------------
% Header: chỉ hiện section/subsection
% ---------------------------
\setbeamertemplate{headline}{%
  \begin{beamercolorbox}[wd=\paperwidth,ht=2.5ex,dp=1ex,leftskip=1em,rightskip=1em]{section in head/foot}
    \insertsectionhead%
    \ifx\insertsubsectionhead\empty
    \else
      ~|~\insertsubsectionhead
    \fi
    \hfill\insertframenumber
  \end{beamercolorbox}%
}

% ---------------------------
% Footer: chỉ hiện số trang
% ---------------------------
%\setbeamertemplate{footline}{%
%  \begin{beamercolorbox}[wd=\paperwidth,ht=2.5ex,dp=1ex,leftskip=1em,rightskip=1em]{page number in head/foot}
%    
%  \end{beamercolorbox}%
% }


% ---------------------------
% Loại bỏ navigation symbols (nút điều hướng)
% ---------------------------
\setbeamertemplate{navigation symbols}{}
\AtBeginSection[]{
    \begin{frame}{Mục lục}
        \tableofcontents[currentsection]
    \end{frame}
}

\usecolortheme{seahorse}
%\usecolortheme{rose}
\begin{document}

\begin{frame}[plain]
\titlepage
\end{frame}


\begin{frame}
\frametitle{Mục lục}
\tableofcontents
\end{frame}

\import{}{bao.tex}
\import{}{qui.tex}
\import{}{phu.tex}
\import{}{an.tex}

\section{Tài liệu tham khảo}
\begin{frame}{Tài liệu tham khảo}

\begin{thebibliography}{9}

\bibitem{clrs}
Thomas H. Cormen, Charles E. Leiserson, Ronald L. Rivest, Clifford Stein.
\textit{Introduction to Algorithms}. MIT Press, 3rd edition, 2009.

\bibitem{wiki-avl}
Wikipedia contributors.
\textit{AVL Tree}. \\
\url{https://en.wikipedia.org/wiki/AVL_tree}

\bibitem{cses-concert}
CSES Problem Set.
\textit{Concert Tickets}. \\
\url{https://cses.fi/problemset/task/1091}

\bibitem{vnoi-thswaps}
VNOI Online Judge.
\textit{THSWAPS - Swap to Sort}. \\
\url{https://oj.vnoi.info/problem/thswaps}

\bibitem{cses-median}
CSES Problem Set.
\textit{Sliding Window Median}. \\
\url{https://cses.fi/problemset/task/1076}

\end{thebibliography}

\end{frame}


\begin{frame}[plain]
\centering
\fontsize{48pt}{20pt}\selectfont Q\&A
\end{frame}

\end{document}