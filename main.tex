%!TeX program = lualatex
\documentclass[handout]{beamer}
\usepackage{forest} % Vẽ cây
\usepackage{polyglossia} 
\setdefaultlanguage{vietnamese}
\setotherlanguage{english}
\usepackage{import}
\usepackage[ruled,vlined]{algorithm2e}
\usepackage{tabularray}

\usetikzlibrary{arrows.meta,matrix,positioning}
\usepackage{minted}

\usepackage[skip=6pt]{caption}  % trong preamble
\captionsetup[table]{position=above}

\tikzset{
  invisible/.style={opacity=0, text opacity=0},
  visible on/.style={alt={#1{}{invisible}}},
  alt/.code args={<#1>#2#3}{%
    \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % Nếu đúng slide: hiện (#2), sai: ẩn (#3)
  }
}
% ----------------------------------------------------------------

\ExplSyntaxOn

\bool_new:N \l_phu_pause_bool

\keys_define:nn { phu / twotrees }
 {
   pause .bool_set:N = \l_phu_pause_bool,
   pause .default:n = true,
 }

\NewDocumentEnvironment{twotrees}{ O{} m m m m }
 {
   \bool_set_false:N \l_phu_pause_bool
   \keys_set:nn { phu / twotrees } { #1 }

   % --- GIẢI PHÁP AN TOÀN TUYỆT ĐỐI ---
   % Thay vì chèn biến vào lệnh \node, ta định nghĩa style cho TikZ ngay tại đây.
   \bool_if:NTF \l_phu_pause_bool
     {
        % Nếu Pause: Node hiện lần lượt <+->, Mũi tên hiện cùng lúc <.->
        \tikzset{ phu_node_style/.style = { visible~on=<+-> } }
        \tikzset{ phu_arrow_style/.style = { visible~on=<.-> } }
     }
     {
        % Nếu Không Pause: Không làm gì cả (hiện luôn)
        \tikzset{ phu_node_style/.style = {} }
        \tikzset{ phu_arrow_style/.style = {} }
     }

   \seq_set_split:Nnn \l_tmpa_seq {/} {#5}
   \seq_pop_left:NN \l_tmpa_seq \l_phu_note_left_tl
   \seq_pop_left:NN \l_tmpa_seq \l_phu_note_right_tl

   \begin{tikzpicture}[>=stealth]

    % --- CÂY TRÁI ---
    % Dùng style "phu_node_style" đã định nghĩa ở trên. Không cần \exp_args rắc rối.
    \node [phu_node_style, rectangle, draw, anchor=north\space west] (lefttree) at (0, 0) {#2};
    
    % --- CÂY PHẢI ---
    % Vì dùng "visible on", lefttree vẫn nằm đó (tàng hình) nên righttree neo vào được -> HẾT LỖI.
    \node [phu_node_style, rectangle, draw, right=#4\space of\space lefttree.north\space east, anchor=north\space west] (righttree) {#3};

     % --- MŨI TÊN ---
     \tl_if_blank:VTF \l_phu_note_right_tl
       {
         \draw [phu_arrow_style, ->, thick, cyan, text=black]
           (lefttree.east) -- node[below]{\l_phu_note_left_tl} ($(lefttree.east)+(#4,0)$);
       }
       {
         \draw [phu_arrow_style, ->, thick, cyan, text=black]
           ($(lefttree.east)+(0,0.1cm)$) -- node[above,text=black]{\l_phu_note_left_tl} ($(lefttree.east)+(#4,0.1cm)$);

         \draw [phu_arrow_style, <-, thick, yshift=6pt, cyan, text=black]
           ($(lefttree.east)-(0,0.1cm)$) -- node[below]{\l_phu_note_right_tl} ($(lefttree.east)+(#4,-0.1cm)$);
       }
 }
 {
   \end{tikzpicture}
 }

\ExplSyntaxOff

\ExplSyntaxOn

% Khai báo biến tạm để chứa text label
\tl_new:N \l_label_one_tl
\tl_new:N \l_label_two_tl

\NewDocumentEnvironment{threetrees}{mmmmm}
 {
   % #1: Code Cây 1 (Trái)
   % #2: Code Cây 2 (Giữa)
   % #3: Code Cây 3 (Phải)
   % #4: Khoảng cách giữa các cây (Distance)
   % #5: Label cho mũi tên (Dạng: "Text 1 / Text 2")

   % 1. Tách chuỗi #5 bằng dấu "/"
   \seq_set_split:Nnn \l_tmpa_seq {/} {#5}
   
   % Lấy label đầu tiên cho mũi tên 1
   \seq_pop_left:NN \l_tmpa_seq \l_label_one_tl
   
   % Lấy label thứ hai (nếu có) cho mũi tên 2, nếu không có thì để trống
   \seq_if_empty:NTF \l_tmpa_seq
     { \tl_clear:N \l_label_two_tl }
     { \seq_pop_left:NN \l_tmpa_seq \l_label_two_tl }

   \begin{tikzpicture}[>=Stealth]

   % --- VẼ 3 CÂY ---
   
   % Cây 1: Gốc tại (0,0)
   \node[rectangle, draw, anchor=north~west] (treeOne) at (0, 0) {#1};
   
   % Cây 2: Nằm bên phải Cây 1
   \node[rectangle, draw, right=#4~of~treeOne.north~east, anchor=north~west] (treeTwo) {#2};
   
   % Cây 3: Nằm bên phải Cây 2
   \node[rectangle, draw, right=#4~of~treeTwo.north~east, anchor=north~west] (treeThree) {#3};

   % --- VẼ MŨI TÊN ---
   
   % Mũi tên 1: Từ Cây 1 -> Cây 2
   \draw[->, thick, cyan, text=black]
     (treeOne.east) -- node[above=2pt] {\l_label_one_tl} ($(treeOne.east)+(#4,0)$);

   % Mũi tên 2: Từ Cây 2 -> Cây 3
   \draw[->, thick, cyan, text=black]
     (treeTwo.east) -- node[above=2pt] {\l_label_two_tl} ($(treeTwo.east)+(#4,0)$);

 }
 {
   \end{tikzpicture}
 }

\ExplSyntaxOff

\forestset{
  node/.style={font={\scriptsize},circle,draw=black,minimum size=1.2em,inner sep=1pt,fill=none,text=black},
  black-node/.style={fill=black,text=white},
  nil-node/.style={rectangle,content={}, minimum size=5pt},
  red-node/.style={node,text=white,draw=red!70!black,fill=red!80!black},
  non-decorate-node/.style={node,draw=none,fill=none,shape=rectangle,text=black},
  tree/.style={for tree={node}},
  rb-tree/.style={tree,for tree={black-node}},
  empty-node/.style={non-decorate-node, minimum size=0pt, inner sep=1pt,content={}},
  rand-node/.style={node,text=white,fill=brown!90!black,draw=brown!70!black},
}


% Title setup
\title{Cây nhị phân tìm kiếm cân bằng}
\subtitle{Cây AVL và Cây Đỏ-đen}
\author{Huỳnh Thiên An -- 23120001\and Hoàng Ngọc Phú -- 23120010\and Hoàng Ngọc Quí -- 23120077\and Nguyễn Duy Bảo -- 23120113}
\institute{Giảng viên: Thầy Nguyễn Hải Đăng}
\date{Thứ ba, ngày 2 tháng 12 năm 2025}

% Beamer setup
% Gói cần thiết
\usetheme{default} % theme cơ bản, bạn có thể đổi theme khác nếu muốn

% ---------------------------
% Header: chỉ hiện section/subsection
% ---------------------------
\setbeamertemplate{headline}{%
  \begin{beamercolorbox}[wd=\paperwidth,ht=2.5ex,dp=1ex,leftskip=1em,rightskip=1em]{section in head/foot}
    \insertsectionhead%
    \ifx\insertsubsectionhead\empty
    \else
      ~|~\insertsubsectionhead
    \fi
    \hfill\insertframenumber
  \end{beamercolorbox}%
}

% ---------------------------
% Footer: chỉ hiện số trang
% ---------------------------
%\setbeamertemplate{footline}{%
%  \begin{beamercolorbox}[wd=\paperwidth,ht=2.5ex,dp=1ex,leftskip=1em,rightskip=1em]{page number in head/foot}
%    
%  \end{beamercolorbox}%
% }


% ---------------------------
% Loại bỏ navigation symbols (nút điều hướng)
% ---------------------------
\setbeamertemplate{navigation symbols}{}
\AtBeginSection[]{
    \begin{frame}{Mục lục}
        \tableofcontents[currentsection]
    \end{frame}
}

\usecolortheme{seahorse}
%\usecolortheme{rose}
\begin{document}

\begin{frame}[plain]
\titlepage
\end{frame}


\begin{frame}
\frametitle{Mục lục}
\tableofcontents
\end{frame}

\import{}{bao.tex}
\import{}{qui.tex}
\import{}{phu.tex}
\import{}{an.tex}

\end{document}